<%= render "shared/header" %>

<div class="index-container">

  <%= form_with url: bookings_path, method: :get, class: "map-search-fields-container py-2" do %>

    <div class="map-search-field">
      <%= text_field_tag :query,
        params[:query],
        class: "form-control",
        placeholder: "Adresse" %>
    </div>

    <div class="map-search-field">
      <%= text_field_tag :time,
      params[:time],
      class: "form-control",
      placeholder: "Time",
      type: "time",
      value: Time.current.strftime('%H:%M')%>
    </div>

  <% end %>

  <div class="map-container"
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

    <div class="booking-cards-container">

      <% @parkings.each do |parking| %>
        <% parking.bookings.each do |booking| %>
          <div class="booking-card d-flex flex-column p-3 rounded mt-2">
            <div class="d-flex align-items-center">
              <% if booking.giver_car.car_type == "citadine" %>
                  <%= image_tag("cars/citadine.png", width: 70, height: 70, crop: :fill) %>
                <% elsif booking.giver_car.car_type == "berline" %>
                  <%= image_tag("cars/berline.png", width: 70, height: 70, crop: :fill) %>
                <% elsif booking.giver_car.car_type == "van" %>
                  <%= image_tag("cars/van.png", width: 70, height: 70, crop: :fill) %>
                <% end %>
                <h5 class="ps-3"><%= time_ago_in_words booking.available_at %></h5>
            </div>
            <div class="d-flex align-items-end justify-content-between">
              <div>
                <p class="mb-0"><%= parking.address %></p>
                <p class="mb-0"><strong>Immatriculation</strong><%= booking.giver_car.plate %> <strong>Couleur</strong><%= booking.giver_car.car_color %></p>
              </div>
              <%= link_to "Se garer", booking_path(booking), data: {turbo_method: :patch}, class: 'bg-secondary text-white px-2 py-1 rounded text-decoration-none' %>
            </div>
          </div>
        <% end %>
      <% end %>

    </div>

</div>

<%= render "shared/navbar" %>
